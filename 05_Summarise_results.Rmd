---
title: "Report"
author: "David McAllister"
date: "24 May 2017"
output: html_document
params:
   effect_number: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(purrr)
effect_number <- params$effect_number
```



## Data

The trials for this analysis are as follows.

```{r, fig.cap = "Trials"}
readRDS("scratch_data/simulated_data1.Rds") %>% 
  filter(drug_group_allocation == "Antidiabetic") %>%
  group_by(my_drug, my_condition) %>%
  summarise(n = length(enrollment), participants = sum(enrollment)) %>% 
  knitr::kable()
```

## Baseline characteristics

The baseline characteristics are as follows.


```{r "Data definition", fig.cap = "Data definition"}
readxl::read_excel("data/sim_df1.xlsx")
```


## Initial tests

I was able to recover estimates for individual trials using the following model.

```{r}
read_delim("jags/simplemodelstring.txt", delim = "\t")
```

I then tried to recover effects for depression-treatment and pain-treatment interactions.
This is the simulation for dataset `r effect_number`.
The coefficients used to create this model are as follows

```{r "Effects definitions", fig.cap = "Effects definitions"}
readxl::read_excel(paste0("data/sim_effects",effect_number, ".xlsx"))
```


## The following results were obtained

```{r}
model_names <- c("con_fixed",
                 "con_pooled",
                 "con_dc_nest",
                 "con_dc_nest_inform",
                 "cat_fixed",
                 "cat_pooled",
                 "cat_dc_nest",
                 "cat_dc_nest_inform")
models <- as.list(model_names)
names(models) <- model_names
models <- map(models, function(x) readRDS(paste0("model_summaries/",x, "_effect", effect_number, ".Rds")))
map(models, function(x) x$stat)
```

## Thoughts

The model showed a really large standard deviation for the null interaction (pain) for the categorical data. I decided to use a moderately informative prior - N(mean = 0, precision = 1/2^2) at the drug-class and whole drug group level, for both interactions.